from unittest import TestCase
from kraken_book import KrakenBookWss
import asyncio

SNAPSHOT = """
[300,{"as":[["18837.00000","1.32745257","1606341726.815227"],["18837.90000","0.15000000","1606341727.105149"],["18838.10000","2.27414836","1606341725.935797"],["18838.30000","0.13300000","1606341715.245590"],["18840.10000","0.61478189","1606341691.035042"],["18840.40000","0.29093000","1606341726.632870"],["18840.50000","2.12385852","1606341724.136787"],["18841.00000","0.04100000","1606341725.351108"],["18841.10000","2.12348838","1606341675.794727"],["18843.00000","0.01400000","1606341726.436577"],["18843.10000","0.10300000","1606341678.871633"],["18843.20000","2.12327457","1606341680.201022"],["18843.30000","1.82570000","1606341724.185262"],["18843.40000","0.05000000","1606341678.737326"],["18843.70000","0.25000000","1606341726.532695"],["18844.40000","0.26641739","1606341727.876489"],["18844.50000","0.16330000","1606341720.610052"],["18844.70000","1.06106578","1606341724.978926"],["18845.00000","0.39697452","1606341724.854127"],["18845.20000","0.46417207","1606341682.104114"],["18846.80000","1.00000000","1606341701.798054"],["18847.90000","0.09700000","1606341652.772276"],["18848.80000","2.12381509","1606341725.106058"],["18849.90000","2.10000000","1606341685.727699"],["18850.40000","0.93517000","1606341727.085656"],["18850.80000","1.40000000","1606341724.616846"],["18851.70000","0.02850000","1606341680.358812"],["18851.80000","1.98565841","1606341727.840504"],["18851.90000","0.10100000","1606341674.789161"],["18852.50000","0.00316654","1606341690.062548"],["18852.70000","0.00185805","1606341706.998505"],["18852.90000","0.00161585","1606341720.502364"],["18853.30000","0.20794318","1606341630.145549"],["18853.90000","2.14958794","1606341701.173233"],["18854.20000","0.73835211","1606341723.161717"],["18854.90000","0.70000000","1606341690.935709"],["18855.00000","0.07955465","1606341678.825941"],["18856.60000","0.91095000","1606341628.370330"],["18857.40000","0.25000000","1606341628.151954"],["18857.50000","4.32282753","1606341725.569171"],["18857.60000","1.47897469","1606341725.490869"],["18857.90000","1.70000000","1606341639.806291"],["18858.30000","0.00180000","1606341672.912753"],["18858.60000","0.50460000","1606341720.568655"],["18860.00000","3.98178649","1606341678.767525"],["18864.50000","0.31604749","1606341718.483291"],["18864.70000","1.50000000","1606341627.806916"],["18865.40000","0.20000000","1606341680.036466"],["18866.70000","0.30002989","1606341723.517087"],["18866.80000","1.00610000","1606341666.343939"],["18867.70000","0.00360000","1606341680.569009"],["18867.90000","1.37462316","1606341720.665566"],["18871.40000","1.60000000","1606341645.218215"],["18871.50000","1.80000000","1606341620.142627"],["18873.70000","0.32958700","1606341727.651870"],["18874.50000","0.72900000","1606341672.363530"],["18876.40000","0.01900000","1606341677.166773"],["18877.10000","1.50918544","1606341645.529375"],["18877.60000","7.21117447","1606341643.969037"],["18878.70000","1.70000000","1606341612.236729"],["18879.40000","0.00185508","1606341634.041247"],["18879.90000","1.71200000","1606341711.089728"],["18882.20000","1.00000000","1606341680.155002"],["18883.80000","0.25000000","1606341706.807919"],["18886.00000","1.40000000","1606341607.662917"],["18887.80000","0.05259072","1606341605.724763"],["18888.60000","0.93750000","1606341724.917417"],["18888.80000","0.24590628","1606341672.067131"],["18892.70000","1.37287304","1606341664.361226"],["18894.00000","9.28493146","1606341628.005334"],["18894.30000","1.60000000","1606341605.908933"],["18895.30000","0.03900000","1606341676.781248"],["18895.50000","0.00102799","1606341627.990093"],["18896.70000","0.01531227","1606341694.652159"],["18900.20000","0.75800000","1606341639.598546"],["18901.20000","2.00000000","1606341549.985976"],["18901.50000","6.50000000","1606341670.301362"],["18904.40000","1.02400000","1606341622.473214"],["18904.80000","4.10423236","1606341703.967670"],["18905.00000","8.19693441","1606341703.172773"],["18906.90000","2.54164241","1606341686.956051"],["18907.10000","4.04896012","1606341684.006524"],["18908.80000","1.44029095","1606341625.411453"],["18908.90000","1.50000000","1606341308.562492"],["18909.10000","0.49030000","1606341219.223724"],["18911.90000","3.74618900","1606341683.930660"],["18912.00000","0.11101000","1606341700.031075"],["18913.30000","1.84278883","1606341662.000696"],["18916.30000","2.00000000","1606341562.301467"],["18918.00000","0.11101000","1606341683.019317"],["18918.80000","0.24590628","1606341688.685305"],["18922.10000","0.75800000","1606341627.068936"],["18924.00000","6.41101000","1606341631.792182"],["18924.10000","1.70000000","1606341240.808175"],["18928.70000","0.18897464","1606341272.736882"],["18929.60000","1.70000000","1606341611.958842"],["18930.00000","0.11101000","1606341712.162287"],["18932.10000","1.04580000","1606341678.886184"],["18932.90000","0.00140530","1606341384.583797"],["18933.30000","1.51500000","1606341537.594679"]],"bs":[["18836.90000","0.56606038","1606341727.863158"],["18835.00000","0.10000000","1606341665.623619"],["18834.00000","0.44843660","1606341727.859569"],["18833.80000","0.68000000","1606341726.906334"],["18833.60000","0.00313583","1606341620.772104"],["18833.20000","1.32746391","1606341727.393218"],["18832.80000","2.12386384","1606341727.772751"],["18832.50000","0.00777338","1606341682.693887"],["18831.40000","2.12402349","1606341722.902171"],["18831.30000","0.04000000","1606341723.013649"],["18831.10000","1.80090000","1606341720.257100"],["18830.80000","0.07716231","1606341709.661126"],["18830.40000","0.48633032","1606341680.172172"],["18830.30000","1.90892683","1606341679.795765"],["18830.10000","2.12417619","1606341722.900210"],["18829.90000","0.00318642","1606341690.064384"],["18829.70000","0.10200000","1606341723.840087"],["18828.80000","2.12411160","1606341704.352990"],["18828.10000","0.07966812","1606341690.334011"],["18827.20000","1.80000000","1606341724.090547"],["18826.60000","0.13300000","1606341705.218719"],["18826.50000","0.04250000","1606341726.434758"],["18826.40000","2.12433283","1606341703.085275"],["18825.30000","0.87806000","1606341723.059021"],["18822.90000","0.10757922","1606341723.866596"],["18822.70000","0.70000000","1606341698.433240"],["18822.60000","0.00216000","1606341651.899567"],["18821.40000","0.05000000","1606341688.599353"],["18821.10000","0.00863849","1606341679.596504"],["18821.00000","0.93775000","1606341722.834284"],["18820.40000","0.03355443","1606341705.817514"],["18820.00000","1.20000000","1606341508.123934"],["18819.40000","0.25000000","1606341723.840529"],["18817.10000","0.09400000","1606341684.917431"],["18816.00000","0.05000000","1606341552.811329"],["18814.90000","2.15535243","1606341715.911670"],["18812.40000","0.02611294","1606341711.189843"],["18812.30000","0.13743895","1606341628.054533"],["18812.20000","1.60000000","1606341683.520697"],["18811.70000","1.40000000","1606341719.410070"],["18811.10000","1.35723049","1606341715.947613"],["18811.00000","0.00623443","1606341713.965191"],["18810.20000","0.97100000","1606341666.036011"],["18809.70000","0.74856000","1606341716.989548"],["18809.40000","0.66756292","1606341685.442171"],["18809.30000","0.00140845","1606341472.943417"],["18808.30000","0.16330000","1606341709.555305"],["18805.60000","3.98292048","1606341701.753300"],["18804.60000","1.90000000","1606341237.497728"],["18802.40000","0.00450192","1606341380.354135"],["18801.70000","1.37946316","1606341715.186718"],["18800.00000","2.53973562","1606341661.035700"],["18799.90000","0.89720648","1606341682.485660"],["18799.30000","0.72000000","1606341676.548532"],["18798.00000","0.00147745","1606341604.915524"],["18797.20000","1.90000000","1606341237.619456"],["18796.70000","0.27650000","1606341679.134065"],["18795.20000","0.00778881","1606337853.601076"],["18793.00000","0.50460000","1606341679.224339"],["18792.40000","4.25991468","1606341713.682128"],["18791.20000","9.51450000","1606341656.940110"],["18791.00000","2.10000000","1606341548.561705"],["18789.20000","0.93750000","1606341623.842929"],["18788.30000","0.00141003","1606338200.305664"],["18788.20000","2.45000000","1606341623.852803"],["18786.40000","0.00341820","1606337432.967657"],["18785.90000","0.08672941","1606341222.867357"],["18784.20000","0.50000000","1606341688.354787"],["18783.80000","1.71200000","1606341647.406146"],["18781.90000","1.90000000","1606341254.391848"],["18780.30000","1.38084954","1606341700.752671"],["18780.00000","1.00000000","1606341608.231983"],["18777.80000","0.05325437","1606339882.090025"],["18775.00000","3.00000000","1606341466.321762"],["18774.90000","2.00000000","1606341605.557603"],["18774.70000","2.55932423","1606341662.960415"],["18774.50000","1.85641258","1606341662.023672"],["18774.40000","6.40000000","1606341271.044720"],["18772.00000","0.10000000","1606341264.230533"],["18771.50000","4.13372428","1606341661.650305"],["18771.20000","0.00201624","1606341639.459677"],["18768.90000","1.80000000","1606341607.495412"],["18768.50000","3.93748399","1606341661.288159"],["18767.30000","0.00141160","1606341561.245127"],["18767.20000","2.24195840","1606341665.764933"],["18767.00000","2.45584674","1606341670.598345"],["18766.90000","7.85164450","1606341666.189686"],["18766.00000","8.55321339","1606341681.144172"],["18765.10000","0.00159792","1606338815.614092"],["18763.30000","0.00314758","1606338495.703669"],["18763.00000","0.03000000","1606340291.601254"],["18762.10000","2.20968568","1606341565.972951"],["18761.90000","2.77937818","1606341567.718243"],["18761.70000","2.56019448","1606341566.972019"],["18760.60000","1.70000000","1606341611.888856"],["18758.90000","0.75800000","1606341639.581553"],["18758.50000","2.66545832","1606341224.078801"],["18758.40000","3.93818183","1606341223.091810"],["18758.00000","0.00780425","1606337922.769124"],["18757.30000","0.00866787","1606338399.574465"]]},"book-100","XBT/USD"]
"""


class checksum100_test(TestCase):

    def setUp(self):
        self.book_wss = KrakenBookWss()
        self.loop = asyncio.new_event_loop()
        asyncio.set_event_loop(None)

    def test_snapshot(self):
        self.loop.run_until_complete(self.book_wss.on_message(None, '{"connectionID":9025186987769841151,"event":"systemStatus","status":"online","version":"1.4.2"}'))
        self.loop.run_until_complete(self.book_wss.on_message(None, '{"channelID":300,"channelName":"book-100","event":"subscriptionStatus","pair":"XBT/USD","reqid":1,"status":"subscribed","subscription":{"depth":100,"name":"book"}}'))
                                     
        self.loop.run_until_complete(self.book_wss.on_message(None, SNAPSHOT))

        self.loop.run_until_complete(self.book_wss.on_message(None, '[300,{"a":[["18851.60000","0.03758329","1606341728.174252"]],"c":"857697091"},"book-100","XBT/USD"]'))

        self.assertTrue(self.book_wss.is_running)
    
